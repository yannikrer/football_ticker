<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>League Standings & Club Details</title>

  <!-- Google-Font (Poppins) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Stylesheet -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>League Standings</h1>
  </header>

  <main>
    <!-- Ligen-Slider -->
    <section id="leagues-section">
      <h2 class="section-title">Ligen</h2>
      <div id="leagues-slider" class="slider">Lade Ligen ...</div>
    </section>

    <!-- Tabelle -->
    <section id="standings-section">
      <h2 class="section-title">Tabelle</h2>
      <div id="standings-container">Noch keine Liga ausgewählt.</div>
    </section>
  </main>

  <!-- Popup für Clubdetails -->
  <div id="popup-container" class="popup hidden">
    <div class="popup-content">
      <span id="close-popup" class="close-button">&times;</span>
      <div id="popup-details">Wähle einen Club aus der Tabelle.</div>
    </div>
  </div>

  <footer>
    <p>Powered by RapidAPI – Free API Live Football Data</p>
  </footer>

  <script>
    /**
     * API-Endpunkte
     */
    const leaguesUrl = 'https://free-api-live-football-data.p.rapidapi.com/football-popular-leagues';
    const standingsUrlBase = 'https://free-api-live-football-data.p.rapidapi.com/football-get-standing-all?leagueid=';
    const clubDetailsUrlBase = 'https://free-api-live-football-data.p.rapidapi.com/football-league-team?teamid=';

    /**
     * RapidAPI-Zugangsdaten
     */
     const rapidApiKey = 'c697ba8d9amsh68666b759affe89p1da10cjsn7fa252973b5c';
    const rapidApiHost = 'free-api-live-football-data.p.rapidapi.com';

    // Popup-Elemente
    const popupContainer = document.getElementById('popup-container');
    const popupDetails = document.getElementById('popup-details');
    const closePopupButton = document.getElementById('close-popup');

    closePopupButton.addEventListener('click', () => {
      popupContainer.classList.add('hidden');
      document.body.classList.remove('blur');
    });

    // Ligen laden beim Start
    fetchLeagues();

    // ----------------------------------------------------
    // Ligen abrufen und in der Slideshow anzeigen
    // ----------------------------------------------------
    async function fetchLeagues() {
      const slider = document.getElementById('leagues-slider');
      slider.textContent = 'Lade Ligen ...';

      try {
        const response = await fetch(leaguesUrl, {
          method: 'GET',
          headers: {
            'X-RapidAPI-Key': rapidApiKey,
            'X-RapidAPI-Host': rapidApiHost
          }
        });
        if (!response.ok) {
          throw new Error(`Fehler (Leagues): ${response.status} - ${response.statusText}`);
        }
        const data = await response.json();
        const leaguesArray = data.response.popular;
        displaySlider(leaguesArray);
      } catch (error) {
        console.error(error);
        slider.textContent = 'Fehler beim Laden der Ligen.';
      }
    }

    function displaySlider(leaguesArray) {
      const slider = document.getElementById('leagues-slider');
      slider.innerHTML = '';

      leaguesArray.forEach(league => {
        const { id, name, logo } = league;

        const slide = document.createElement('div');
        slide.className = 'slide';

        slide.innerHTML = `
          <img src="${logo}" alt="${name}" class="league-logo">
          <h3>${name}</h3>
        `;

        slide.addEventListener('click', () => {
          fetchStandings(id);
        });

        slider.appendChild(slide);
      });
    }

    // ----------------------------------------------------
    // Tabelle abrufen und anzeigen
    // ----------------------------------------------------
    async function fetchStandings(leagueId) {
      const container = document.getElementById('standings-container');
      container.textContent = 'Lade Tabelle ...';

      const url = standingsUrlBase + leagueId;
      try {
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'X-RapidAPI-Key': rapidApiKey,
            'X-RapidAPI-Host': rapidApiHost
          }
        });
        if (!response.ok) {
          throw new Error(`Fehler (Standings): ${response.status} - ${response.statusText}`);
        }
        const data = await response.json();
        const standingsArray = data.response.standing;
        displayStandings(standingsArray);
      } catch (error) {
        console.error(error);
        container.textContent = 'Fehler beim Laden der Tabelle.';
      }
    }

    function displayStandings(standingArray) {
      const container = document.getElementById('standings-container');
      container.innerHTML = '';

      if (!Array.isArray(standingArray) || standingArray.length === 0) {
        container.textContent = 'Keine Daten gefunden.';
        return;
      }

      const table = document.createElement('table');
      table.className = 'standings-table';

      const thead = document.createElement('thead');
      thead.innerHTML = `
        <tr>
          <th>Platz</th>
          <th>Teamname</th>
          <th>Spiele</th>
          <th>Siege</th>
          <th>Unentschieden</th>
          <th>Niederlagen</th>
          <th>Punkte</th>
          <th>Tore</th>
        </tr>
      `;
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      standingArray.forEach((team, index) => {
        const { name, played, wins, draws, losses, scoresStr, pts, id } = team;

        const row = document.createElement('tr');

        const rankCell = document.createElement('td');
        rankCell.textContent = index + 1;
        row.appendChild(rankCell);

        const nameCell = document.createElement('td');
        nameCell.textContent = name ?? '-';
        nameCell.style.cursor = 'pointer';
        nameCell.style.color = 'blue';
        nameCell.addEventListener('click', () => {
          fetchClubDetails(id);
        });
        row.appendChild(nameCell);

        const playedCell = document.createElement('td');
        playedCell.textContent = played ?? '-';
        row.appendChild(playedCell);

        const winsCell = document.createElement('td');
        winsCell.textContent = wins ?? '-';
        row.appendChild(winsCell);

        const drawsCell = document.createElement('td');
        drawsCell.textContent = draws ?? '-';
        row.appendChild(drawsCell);

        const lossesCell = document.createElement('td');
        lossesCell.textContent = losses ?? '-';
        row.appendChild(lossesCell);

        const pointsCell = document.createElement('td');
        pointsCell.textContent = pts ?? '-';
        row.appendChild(pointsCell);

        const scoresCell = document.createElement('td');
        scoresCell.textContent = scoresStr ?? '-';
        row.appendChild(scoresCell);

        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      container.appendChild(table);
    }

    // ----------------------------------------------------
    // Clubdetails abrufen und im Popup anzeigen
    // ----------------------------------------------------
    async function fetchClubDetails(teamId) {
      popupContainer.classList.remove('hidden');
      document.body.classList.add('blur');
      popupDetails.textContent = 'Lade Clubdetails ...';

      const url = clubDetailsUrlBase + teamId;
      try {
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'X-RapidAPI-Key': rapidApiKey,
            'X-RapidAPI-Host': rapidApiHost
          }
        });
        if (!response.ok) {
          throw new Error(`Fehler (Clubdetails): ${response.status} - ${response.statusText}`);
        }
        const data = await response.json();
        const details = data.response.details;
        popupDetails.innerHTML = `
          <h3>${details.name}</h3>
          <p><strong>Stadion:</strong> ${details.sportsTeamJSONLD.location.name}</p>
          <p><strong>Kapazität:</strong> ${details.faqJSONLD.mainEntity[2].acceptedAnswer.text}</p>
          <p><strong>Nächstes Spiel:</strong> ${details.faqJSONLD.mainEntity[0].acceptedAnswer.text}</p>
          <p><strong>Land:</strong> ${details.country}</p>
          <p><strong>Saison:</strong> ${details.latestSeason}</p>
        `;
      } catch (error) {
        console.error(error);
        popupDetails.textContent = 'Fehler beim Laden der Clubdetails.';
      }
    }

    async function fetchClubDetails(teamId) {
  // Popup anzeigen
  popupContainer.classList.remove('hidden'); // Popup sichtbar machen
  document.body.classList.add('blur'); // Hintergrund unscharf machen
  popupDetails.textContent = 'Lade Clubdetails ...'; // Ladeanzeige

  const url = clubDetailsUrlBase + teamId; // API-URL
  try {
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'X-RapidAPI-Key': rapidApiKey,
        'X-RapidAPI-Host': rapidApiHost,
      },
    });
    if (!response.ok) {
      throw new Error(`Fehler (Clubdetails): ${response.status} - ${response.statusText}`);
    }
    const data = await response.json(); // API-Antwort parsen
    const details = data.response.details;

    // Inhalte im Popup anzeigen
    popupDetails.innerHTML = `
      <h3>${details.name}</h3>
      <p><strong>Stadion:</strong> ${details.sportsTeamJSONLD.location.name}</p>
      <p><strong>Kapazität:</strong> ${details.faqJSONLD.mainEntity[2].acceptedAnswer.text}</p>
      <p><strong>Nächstes Spiel:</strong> ${details.faqJSONLD.mainEntity[0].acceptedAnswer.text}</p>
      <p><strong>Land:</strong> ${details.country}</p>
      <p><strong>Saison:</strong> ${details.latestSeason}</p>
    `;
  } catch (error) {
    console.error(error);
    popupDetails.textContent = 'Fehler beim Laden der Clubdetails.';
  }
}

// Popup schließen
closePopupButton.addEventListener('click', () => {
  popupContainer.classList.add('hidden'); // Popup verstecken
  document.body.classList.remove('blur'); // Hintergrund wieder scharf machen
});

  </script>
</body>
</html>
